<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cora Hirst">

<title>Cora Hirst Data Analysis Portfolio - Data Exercise Week 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Cora Hirst Data Analysis Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../aboutme.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../starter-analysis-exercise/products/report/starter-analysis-report.html" rel="" target="">
 <span class="dropdown-text">Starter Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../coding-exercise/coding-exercise.html" rel="" target="">
 <span class="dropdown-text">R Coding Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../presentation-exercise/presentation-exercise.html" rel="" target="">
 <span class="dropdown-text">Presentation Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../tidytuesday-exercise/tidytuesday-exercise.html" rel="" target="">
 <span class="dropdown-text">Tidy Tuesday Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../data-exercise/code/data-exercise.html" rel="" target="">
 <span class="dropdown-text">Data Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../cdc-exercise/code/cdcdata-exercise.html" rel="" target="">
 <span class="dropdown-text">Data Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../fitting-exercise/fitting-exercise.html" rel="" target="">
 <span class="dropdown-text">Fitting exercise</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/CoraHirst/corahirst-MADA-portfolio" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Exercise Week 4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Cora Hirst </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Install and load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("purrr")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("lubridate")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("ggplot2")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("readxl")</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("openxlsx")</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("gtsummary")</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("flextable")</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("here")</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>The purpose of this exercise is two-fold:</p>
<ol type="1">
<li>I would like to demosntrate how to generate a synthetic dataset with hidden assocaitions between variables, and how we can uncover those variables through statistical techniques we employ on “real”-world, observational datasets, and</li>
<li>I would like to make a comment about the difference between using statistics to <em>make predictive models</em> and using statistics to <em>infer causality</em>; how do we design a data analysis that allows us to generate hypotheses about the relationships between variables, and to begin to explore and test these hypotheses?</li>
</ol>
<p>To do so, I am going to generate a synthetic dataset of a hypothetical group of patients who have tested postitive for some infection. These patients will have given us information about their age, the date of their post recent vaccination against this infection, and the approximate date they believed they were infected. Lastly, the severity of their illness will be reported on a 1-10 scale.</p>
<p>Disease severity will be assigned to each individual probabilistically, given their age and the <strong>time between the date of their vaccination and the date of their infection</strong>.</p>
<p>In my analysis, I will demonstrate that good predictive models can be built with simply the reported variables (<code>age</code>, <code>time_post_vaccination</code>, and <code>time_post_infection</code>.)</p>
<p>However, I will show that the best fitting model is that which incorporates two varaibles only: age, and a manipulated variable representing the time between vaccination and infection. This is the <em>true</em> predictor, or the two variables I used to generate disease severity.</p>
<p>The best model thus becomes a topic for discussion: do we want the simplest model (fewest variables) which can predict diesease severity? Do we want to best fitting model that utilizes only the reported variables? Do we want to develop a model to test a hypothesis - for instance, that individuals who were more recently vaccinated before they were infected have a better outcome?</p>
</section>
<section id="generating-a-synthetic-dataset" class="level1">
<h1>Generating a synthetic dataset</h1>
<p>For this assignment, I will be generating a synthetic dataset with built-in associations between variables. Then, I will be recovering these associations.</p>
<section id="synthetic-dataset-generation-high-disease-severity-in-patients-is-correlated-with-a-longer-time-between-infection-and-vaccination" class="level2">
<h2 class="anchored" data-anchor-id="synthetic-dataset-generation-high-disease-severity-in-patients-is-correlated-with-a-longer-time-between-infection-and-vaccination">Synthetic Dataset Generation: High disease severity in patients is correlated with a longer time between infection and vaccination</h2>
<p>The chunk below simply sets a seed for reproducibility (I’d like for my probability function to assign the same numbers each time I run it), and defines the number of observations I’d like to generate in my dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of observations to generate</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>n_patients <span class="ot">&lt;-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, I will be generating the dataset as a <code>data.frame</code>. The dataset will contain 5 variables: <code>pat_ID</code> will be a character variable storing the IDs of various patients; <code>age</code> will store the age of each of these patients, and I will restrict these ages between 10 and 100; <code>time_post_vaccination</code> will be a numeric variable storing the amount of time elapsed, in days, since the most recent vaccination; <code>time_post_infection</code> will be a numerical variable storing the amount of time elapsed, in days, since the approximate date at which the patient was infected; and finally, <code>disease_severity</code> will be a categorical variable storing an arbitrary measure of disease severity, ranked as an integer between 0 (asymptomatic) and 10 (death, sadly).</p>
<p>I chose to create an association between the <em>amount of time between the most recent vaccination and infection</em> (hereon refered to as “time between”) and <em>disease severity</em>. The simplest way to do this, and the way I chose, is to treat the amount of time between the most recent vaccination and infection as proportional to the probability of severe disease.</p>
<p>I decided that the individual with the greatest time between infection and vaccination would undoubtedly have the greatest disease severity. Technically, I divided the <em>time between</em> for each patient by the <em>maximum time between</em> among all patients (<span class="math inline">\(\frac{time \ between}{max \ time \ between}\)</span>) - this is the probability of severe disease independent of other factors.</p>
<p>However, I also want some association between age and the probability of severe disease; so, I define the actual probability of severe disease as <span class="math inline">\(\frac{time \ between}{max \ time \ between} \times \frac{age}{max \ age}\)</span>. This way, the oldest individuals with he greatest time between infection and vaccination have the worst disease severity.</p>
<p>Then, starting the disease severity of each individual at <span class="math inline">\(0\)</span>, I generate a random number between 0 and 1. If an individual’s probability of severe disease is greater than this randomly generated number, I add <span class="math inline">\(1\)</span> to their disease severity. I do this 10 times, so the maximum possible disease severity is <span class="math inline">\(10\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## empty dataframe with n_patients observations </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pat_id =</span> <span class="fu">character</span>(n_patients), <span class="co">#patient ID</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">numeric</span>(n_patients), <span class="co">#patient age</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_post_vaccination =</span> <span class="fu">integer</span>(n_patients), <span class="co">#days elapsed since last vaccination </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_post_infection =</span> <span class="fu">numeric</span>(n_patients), <span class="co">#days elapsed since infection</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">disease_severity =</span> <span class="fu">integer</span>(n_patients) <span class="co">#on a scale from 1-10, how "bad" were illness symptoms</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="do">## populating the variables</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># patient id</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>pat_id <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"ID_"</span>, <span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">999</span>, <span class="dv">100</span>, <span class="at">replace=</span>F) ) <span class="co"># each gets a 3-digit ID because I feel like it </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># patient age</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>age <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">50</span>, <span class="dv">30</span>, <span class="at">replace=</span>T), <span class="fu">sample</span>(<span class="dv">51</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">70</span>, <span class="at">replace =</span> T)) <span class="co">#I want to have more samples from age &lt; 50, and to not children under 10</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time_post_infection <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">60</span>, <span class="dv">100</span>, <span class="at">replace=</span>T)) <span class="co"># between one week and two months</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time_post_vaccination <span class="ot">=</span> data<span class="sc">$</span>time_post_infection <span class="sc">+</span> <span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">200</span>, <span class="dv">100</span>, <span class="at">replace=</span>T)) <span class="co"># all individuals had a vaccination between 1 month and 200 days before their infection </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="do">### alright, now I want to make a correlation between disease severity in the time between vaccination and infection. That means I need to add a third column, time between vaccination and infection, and bias my samples of numbers 1:10 by that number. Then I'll delete that column so that the "analyst" has to think of it themselves muahahahaha</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>time_between <span class="ot">=</span> data<span class="sc">$</span>time_post_vaccination <span class="sc">-</span> data<span class="sc">$</span>time_post_infection <span class="co">#the bigger the difference, the greater the probability of getting 10</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">## how to do disease severity? for loop 10 times. Probability of adding 1 is equal to (timebetween/maxtimebetween); thus, if a randomly generated number between 0 and 1 is less than this probability, we add 1 to disease severity. The longer between vaccine and infection, the worse protected we are! -&gt; sometime it would be cool to alter this so there is some penalty to getting infected immediatly after vaccination. :)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="do">## however, I also want some relationship between age and disease severity. So, I am going to reduce the "effective" time between vaccination and infection by age. </span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># vector to store our simulated disease severities</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>disease_severities <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation to generate disease severities based on time between vaccination and infection </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(c <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_patients){</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">=</span> (data[i, <span class="st">"time_between"</span>])<span class="sc">/</span><span class="fu">max</span>(data<span class="sc">$</span>time_between)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    age_adjust_prob <span class="ot">=</span> prob <span class="sc">*</span> (data[i, <span class="st">"age"</span>])<span class="sc">/</span><span class="fu">max</span>(data<span class="sc">$</span>age)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    rand <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(age_adjust_prob <span class="sc">&gt;</span> rand){disease_severities[i] <span class="ot">=</span> disease_severities[i] <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">=</span> c<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># add these disease severities to our dataset as FACTOR</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>disease_severity <span class="ot">=</span> <span class="fu">factor</span>(disease_severities)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co">#finally, remove our "time between" category - though I'm just going to add it back in the next code chunk ;)</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> data[,<span class="sc">!</span>(<span class="fu">names</span>(data) <span class="sc">%in%</span> <span class="st">"time_between"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">### and now we have our dataset! I can write it as an excel workbook for the sake of reproducibility, and I'll add my codebook to it</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>codebook <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(data),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">description =</span> <span class="fu">c</span>(<span class="st">"unique patient 3-digid ID"</span>, <span class="st">"patient age, range [10,100]"</span>, <span class="st">"time elapsed since patient's most recent vaccine, range [64,249]"</span>, <span class="st">"time elapsed since approximate date of infection, range [7,60]"</span>, <span class="st">"categorical measure of disease severity, scale of 0 (asymptomatic) to 10 (death)"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"character: ID_XXX"</span>, <span class="st">"numerical"</span>, <span class="st">"numerical"</span>, <span class="st">"numerical"</span>, <span class="st">"factor"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># save the data dataframe and codebook dataframe in a list for export</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>synth_data_list <span class="ot">=</span> <span class="fu">list</span>(data, codebook)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(synth_data_list) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"breakthrough_infections"</span>, <span class="st">"codebook"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># saving dataset with openxlsx</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>processed_dataset <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"data"</span>, <span class="st">"synthetic_data_vaccines_work.xlsx"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(synth_data_list, <span class="at">file =</span> processed_dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploring-synthetic-data-do-i-observe-the-correct-predictors-for-disease-severity" class="level2">
<h2 class="anchored" data-anchor-id="exploring-synthetic-data-do-i-observe-the-correct-predictors-for-disease-severity">Exploring Synthetic Data: Do I observe the correct predictors for disease severity?</h2>
<p>In the following code chunk, I explore my synthetic dataset to see which variables appear to have the greatest effect on <code>disease_severity</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what is the structure? Do my variables take the form I expect? </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  5 variables:
 $ pat_id               : chr  "ID_514" "ID_562" "ID_278" "ID_625" ...
 $ age                  : int  46 17 19 43 19 31 21 29 26 44 ...
 $ time_post_vaccination: int  176 150 125 124 124 135 145 94 171 110 ...
 $ time_post_infection  : int  35 57 16 59 60 19 49 17 31 58 ...
 $ disease_severity     : Factor w/ 11 levels "0","1","2","3",..: 4 3 1 1 1 4 2 2 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    pat_id               age        time_post_vaccination time_post_infection
 Length:100         Min.   :14.00   Min.   : 64.0         Min.   : 7.00      
 Class :character   1st Qu.:42.50   1st Qu.:109.5         1st Qu.:19.75      
 Mode  :character   Median :63.50   Median :155.5         Median :32.00      
                    Mean   :62.26   Mean   :153.2         Mean   :33.02      
                    3rd Qu.:83.25   3rd Qu.:187.5         3rd Qu.:47.00      
                    Max.   :99.00   Max.   :249.0         Max.   :60.00      
                                                                             
 disease_severity
 2      :16      
 0      :14      
 3      :13      
 5      :12      
 8      :12      
 6      :11      
 (Other):22      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what is the distribution of individuals by age? disease_severity? </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plot0 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y=</span>..density..), <span class="at">colour=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> age), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"salmon"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(data<span class="sc">$</span>age), <span class="at">color=</span><span class="st">"salmon"</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"distribution of patients by age"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> disease_severity), <span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">colour=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">ceiling</span>(<span class="fu">mean</span>(<span class="fu">as.numeric</span>(<span class="fu">levels</span>(data<span class="sc">$</span>disease_severity))[data<span class="sc">$</span>disease_severity])), <span class="at">color=</span><span class="st">"blue"</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"distribution of patients by disease severity"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># let's see distribution of ages in each disease severity category </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> disease_severity, <span class="at">y =</span> age)) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x =</span> disease_severity, <span class="at">y =</span> age, <span class="at">col =</span> disease_severity), <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"disease severity"</span>, <span class="at">y =</span> <span class="st">"age"</span>, <span class="at">title =</span> <span class="st">"ages of patients in each disease category"</span>) <span class="sc">+</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> <span class="co"># I dont want the legend to show</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"forestgreen"</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"springgreen"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"olivedrab1"</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"gold"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"goldenrod1"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"orange"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"darkorange2"</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"orangered2"</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"red3"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"darkred"</span>))</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># let's see if disease severity correlates with age </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span>data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> disease_severity, <span class="at">col =</span> time_post_vaccination)) <span class="sc">+</span> </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> age,  <span class="at">y=</span><span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity]), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="co">#had to unfactor the disease severity categoriy with as.numeric(levels())[]</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"age"</span>, <span class="at">y =</span> <span class="st">"disease severity"</span>, <span class="at">title =</span> <span class="st">"correlation between disease severity and age"</span>)  </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#heck yeah it does, so that part of the simulation worked! </span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co"># let's see if disease severity correlates with time since vaccination</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x=</span>time_post_vaccination, <span class="at">y=</span>disease_severity)) <span class="sc">+</span> </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> time_post_vaccination, <span class="at">y=</span><span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity]), <span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="co">#had to unfactor the disease severity categoriy with as.numeric(levels())[]</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"time post vaccination"</span>, <span class="at">y =</span> <span class="st">"disease severity"</span>, <span class="at">title =</span> <span class="st">"correlation between disease severity and time since vaccination"</span>) </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co"># same for time post infection </span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>plot5 <span class="ot">=</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x=</span>time_post_infection, <span class="at">y=</span>disease_severity)) <span class="sc">+</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"time post infection"</span>, <span class="at">y =</span> <span class="st">"disease severity"</span>, <span class="at">title =</span> <span class="st">"correlation between disease severity and time post infection"</span>)  </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="do">## save these files </span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 0 - yes, I added one and was too lazy to change the numbering </span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"age_distribution.png"</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot0) </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 1</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"severity_distribution.png"</span>)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot1) </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 2</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"age_severity_boxplots.png"</span>)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot2) </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 3</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"age_severity_scatter.png"</span>)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot3) </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 4</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"time_post_vacc_severity_scatter.png"</span>)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot4) </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="co">#figure 5</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>figure_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"figures"</span>, <span class="st">"time_post_inf_severity_scatter.png"</span>)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> figure_file, <span class="at">plot=</span>plot5) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I introduced an association between <code>age</code> and <code>disease_severity</code>, and I should observe some positive correlation between <code>disease_severity</code> and <code>age</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-age-severity-boxplots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/age_severity_boxplots.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Summary of the distribution of ages of patients with varying diseases severities. Each colored point represents one patient.</figcaption>
</figure>
</div>
</div>
</div>
<p>Clearly, there is a correlation between age and disease severity (<a href="#fig-age-severity-boxplots">Figure&nbsp;1</a>.) Interestingly, the distribution of ages of patients with high disease severities is particularly narrow when compared to patients with lower disease severities; this can in part be attributed to a smaller representation of patients with high disease severity (<a href="#fig-severity-distribution">Figure&nbsp;2</a>.)</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-severity-distribution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/severity_distribution.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Distribution of patients with varying diseases severities. Blue line shows the mean disease severity across patients.</figcaption>
</figure>
</div>
</div>
</div>
<p>However, we also need to take into consideration that there are a large number of older patients (<a href="#fig-age-distribution">Figure&nbsp;3</a>), and a wider distribution of the older aged individuals across disease severity.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-age-distribution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/age_distribution.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Distribution of patients by age. Pink line shows the mean age across patients.</figcaption>
</figure>
</div>
</div>
</div>
<p>Thus, there is likely some other variable influencing the number of patients with high disease severity. When I plot the correlation between age and disease severity <em>and observe the associated time elapsed since last vaccination</em> (<a href="#fig-age-severity-scatter">Figure&nbsp;4</a>), it becomes apparent that higher disease severities are associated with longer times post vaccination (light colored dots).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-age-severity-scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/age_severity_scatter.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Correlation between patient’s age and disease severity.</figcaption>
</figure>
</div>
</div>
</div>
<p>Referring back to the generation of the dataset, I also introduced an association between the time between <code>time_post_vaccination</code> and <code>time_post_infection</code> and <code>disease_severity</code>. I expect that, without calculating and plotting this time difference itself against <code>disease_severity</code>, there should be some signal of the negative correlation in the plot of <code>time_post_vaccination</code> and <code>disease_severity</code>. Because <code>time_post_vaccination</code> has a wider range than <code>time_post_infection</code>, I anticipate it will have had a greater effect on the variation within the difference between <code>time_post_vaccination</code> and <code>time_post_infection</code>; thus, I expect this signal to be lost when plotting the relationship between <code>time_post_infection</code> and <code>disease_severity</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-time-post-vacc-severity-scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/time_post_vacc_severity_scatter.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Correlation between the time elapsed since the individual’s last vaccination and disease severity.</figcaption>
</figure>
</div>
</div>
</div>
<p>There is, in fact, some positive correlation recovered between the time elapsed since a patient’s last vaccination and the severity of their disease (<a href="#fig-time-post-vacc-severity-scatter">Figure&nbsp;5</a>.) However, the significance of this association is not apparent.</p>
<p>Lastly, I would also like to see if the time elapsed since being effected (how long the patient had been infected before the observation was made) has any visual effect- it’s important to see if my random sampling and pairing has generated any!</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-time-post-inf-severity-scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../figures/time_post_inf_severity_scatter.png" class="img-fluid figure-img" width="1050"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Correlation between the time elapsed since the individual’s infection and disease severity.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-time-post-inf-severity-scatter">Figure&nbsp;6</a> demonstrates that there is little correlation between disease severity and the time elapsed since becoming infected.</p>
<ol start="2" type="1">
<li>Also greater variation in the ages of patients with lower disease severities than higher disease severities, and not just dependent upon fewer samples (more samples captured for older ages) -&gt; though may be a result of fewer samples for youths. Could check this out by exploring ages before and after the mean as independent datasets (for later!)</li>
</ol>
</section>
<section id="synthetic-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="synthetic-data-analysis">Synthetic Data Analysis</h2>
<p>Visually, I have recovered some association between <code>disease_severity</code> and <code>age</code>, as well as <code>disease_severity</code> and <code>time_post_vaccination</code>. I use the following linear regression model to determine the significance of these correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determine best fit linear models </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">data =</span> data, <span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity]<span class="sc">~</span>age) <span class="co">#how good is age at predicting disease severity (linearly)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">=</span> <span class="fu">lm</span>(<span class="at">data =</span> data, <span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity]<span class="sc">~</span>time_post_vaccination) <span class="co">#how good is time post vaccination at estimating disease severity? </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># generate tables to present</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">=</span> fit1 <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>() <span class="co">#save summaries as tables using tbl_regression() function from gtsummary package</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">=</span> fit2 <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>() <span class="co">#save summaries as tables using tbl_regression() function from gtsummary package</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary tables</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>summarytable_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"tables"</span>, <span class="st">"lm_severity_age.rds"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(table1, <span class="at">file =</span> summarytable_file)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>summarytable_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"tables"</span>, <span class="st">"lm_severity_time_post_vacc.rds"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(table1, <span class="at">file =</span> summarytable_file)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># extract p-values from summaries to display on figures</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>p.age <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">summary</span>(fit1)<span class="sc">$</span>coefficients[,<span class="st">"Pr(&gt;|t|)"</span>])[<span class="dv">2</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>p.time_post_vaccination <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">summary</span>(fit2)<span class="sc">$</span>coefficients[,<span class="st">"Pr(&gt;|t|)"</span>])[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-lm-severity-age" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Linear regression model of disease severity by age.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Characteristic</strong></th>
<th style="text-align: left;"><strong>Beta</strong></th>
<th style="text-align: left;"><strong>95% CI</strong></th>
<th style="text-align: left;"><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.06, 0.09</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-lm-severity-time-post-vacc" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;2: Linear regression model of disease severity by time elapsed since vaccination.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Characteristic</strong></th>
<th style="text-align: left;"><strong>Beta</strong></th>
<th style="text-align: left;"><strong>95% CI</strong></th>
<th style="text-align: left;"><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.06, 0.09</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Both the association between disease severity and age as well as disease severity and time post vaccination are significant (<span class="math inline">\(p&lt;0.05\)</span>; <a href="#tbl-lm-severity-age">Table&nbsp;1</a>, <a href="#tbl-lm-severity-time-post-vacc">Table&nbsp;2</a>.) Thus, either variable appears to be a pretty good predictor of disease severity.</p>
<p>But, we know from figures <a href="#fig-age-severity-scatter">Figure&nbsp;4</a> and, especially, <a href="#fig-time-post-vacc-severity-scatter">Figure&nbsp;5</a> that the interaction between these terms may be an even better predictor of disease severity. If our goal is to generate the best model to help <em>predict</em> the disease severity of a patient, we might want to fit a linear model with <em>both</em> of these variables as predictors.</p>
<p>The following code chunk fits this multi-variable linear model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determine best fit models</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity] <span class="sc">~</span> time_post_vaccination <span class="sc">+</span> time_post_infection <span class="sc">+</span> age, <span class="at">data=</span>data)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate tables to present</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">=</span> model1 <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>() <span class="co">#save summaries as tables using tbl_regression() function from gtsummary package</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary tables</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>summarytable_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"tables"</span>, <span class="st">"lm_severity_all.rds"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(table1, <span class="at">file =</span> summarytable_file)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># extract p-values from summaries to display on figures</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>p.all <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">summary</span>(model1)<span class="sc">$</span>coefficients[,<span class="st">"Pr(&gt;|t|)"</span>])[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-lm-severity-all" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3: Linear regression model of disease severity by age, time elapsed since vaccination, and time elapsed since infection.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Characteristic</strong></th>
<th style="text-align: left;"><strong>Beta</strong></th>
<th style="text-align: left;"><strong>95% CI</strong></th>
<th style="text-align: left;"><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.06, 0.09</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This model also provides a significant p-value. But how different are the p-values for these three models: disease severity ~ age, disease severity ~ time post vaccination, and disease severity ~ age + time post vaccination + time post infection?</p>
<table class="table">
<caption>comparing p-values for different linear predictors of disease severity</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 42%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>age</th>
<th style="text-align: left;">time_post_vaccination</th>
<th style="text-align: right;">age + time_post_infection + time_post_vaccination</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5.7339746^{-14}</td>
<td style="text-align: left;">2.5827222^{-15}</td>
<td style="text-align: right;">4.3594356^{-17}</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>It looks like the multivariable linear regression of disease severity with age, time post vaccination, and time post infection fits the model significantly better than either age or time post vaccination alone.</p>
<p>If I were to receive this dataset without knowing the associations I built into (and if I weren’t particularly clever, jury’s out on that one!), I might stop there and say that either variable is a good predictor of illness.</p>
<p>But, I know that the true predictor of disease severity is the difference between <code>time_post_vaccination</code> and <code>time_post_infection</code>; that is, I wanted to generate the data so that individuals who were most recently vaccinated had a better disease outcome than those who were vaccinated a longer time before infection. In the following code chunk, I add the variable <span class="math inline">\(diff_between\)</span> to the dataset - this is the time between vaccination and infection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add variable for time between vaccination and infection </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>diff_between <span class="ot">=</span> data<span class="sc">$</span>time_post_vaccination<span class="sc">-</span>data<span class="sc">$</span>time_post_infection</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># determine best fit models</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity] <span class="sc">~</span> diff_between, <span class="at">data=</span>data)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">as.numeric</span>(<span class="fu">levels</span>(disease_severity))[disease_severity] <span class="sc">~</span> diff_between <span class="sc">+</span> age, <span class="at">data=</span>data)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># generate tables to present</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">=</span> model2 <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>() <span class="co">#save summaries as tables using tbl_regression() function from gtsummary package</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>table3 <span class="ot">=</span> model3 <span class="sc">%&gt;%</span> gtsummary<span class="sc">::</span><span class="fu">tbl_regression</span>() <span class="co">#save summaries as tables using tbl_regression() function from gtsummary package</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary tables</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>summarytable_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"tables"</span>, <span class="st">"lm_severity_diff_between.rds"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(table2, <span class="at">file =</span> summarytable_file)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save summary tables</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>summarytable_file <span class="ot">=</span> <span class="fu">here</span>(<span class="st">"data-exercise"</span>, <span class="st">"tables"</span>, <span class="st">"lm_severity_diff_between_age.rds"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(table3, <span class="at">file =</span> summarytable_file)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># extract p-values from summaries to display on figures</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>p.diff_between <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">summary</span>(model2)<span class="sc">$</span>coefficients[,<span class="st">"Pr(&gt;|t|)"</span>])[<span class="dv">2</span>]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>p.diff_between_age <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">summary</span>(model3)<span class="sc">$</span>coefficients[,<span class="st">"Pr(&gt;|t|)"</span>])[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-lm-diff-between" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;4: Linear regression model of disease severity by difference betweem time of vaccination and time of infection.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Characteristic</strong></th>
<th style="text-align: left;"><strong>Beta</strong></th>
<th style="text-align: left;"><strong>95% CI</strong></th>
<th style="text-align: left;"><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">diff_between</td>
<td style="text-align: left;">0.04</td>
<td style="text-align: left;">0.03, 0.05</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-lm-diff-between-age" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;5: Linear regression model of disease severity by age and difference betweem time of vaccination and time of infection.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Characteristic</strong></th>
<th style="text-align: left;"><strong>Beta</strong></th>
<th style="text-align: left;"><strong>95% CI</strong></th>
<th style="text-align: left;"><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">diff_between</td>
<td style="text-align: left;">0.03</td>
<td style="text-align: left;">0.03, 0.04</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">0.06</td>
<td style="text-align: left;">0.04, 0.07</td>
<td style="text-align: left;">&lt;0.001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Tables <a href="#tbl-lm-diff-between">Table&nbsp;4</a> and <a href="#tbl-lm-diff-between-age">Table&nbsp;5</a> reveal that these models are also significant predictive models. Lets compare these fits with the best fit multi-variable model:</p>
<table class="table">
<caption>comparing p-values for different linear predictors of disease severity</caption>
<colgroup>
<col style="width: 42%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>age + time_post_infection + time_post_vaccination</th>
<th style="text-align: left;">diff_between</th>
<th style="text-align: right;">diff_between + age</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.3594356^{-17}</td>
<td style="text-align: left;">1.1779262^{-16}</td>
<td style="text-align: right;">2.3592392^{-17}</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>We can see that the time between vaccination and infection (<code>diff_between</code>) is a better predictor of disease severity than either age or time elapsed since vaccination, though the mutli variable model with the three variable <code>age</code>, <code>time_post_vaccination</code>, and <code>time_post_infection</code> is still a better predictor than <code>diff_between</code>.</p>
<p>However, the <em>best</em> predictor is actually the multi-variable model with fewer variables! <code>diff_between</code> and <code>age</code> predict disease severity better than all three variables, <code>age</code>, <code>time_post_vaccination</code>, and <code>time_post_infection</code>. Plus, we know (because I generated the model!) that there is some <em>causal</em> motivation for creating this fourth variable, <code>diff_between</code>.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I want to make a note here that the most complex model <em>might not always</em> be the best fitting model, and furthermore, that we might miss some interesting interactions between variables if we don’t consider how the interactions between them can help predict our outcome when we build our models!</p>
<p>I also want to note that a “significant p-value” doesn’t mean that the biological/natural motivation behind your model is actually the truth; in fact, all of the regressions I performed predicted disease severity pretty well! If our goal is to make predictions about outcomes given predictor variables, then we might be motivated either to chose the <em>simplest model</em> that gives us the most robust output, or the <em>best fitting model</em> without assumptions of causality. But, if we want to begin testing hypotheses about <em>why these variables are correlated with disease outcome</em>, then we want to begin being clever about manipulations we can conduct with our variables to infer causality! (and then, of course, less observational and more causal studies, where we can! Cohort, etc…)</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>